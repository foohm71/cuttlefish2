# Cuttlefish API (FastAPI Backend)

This folder contains the FastAPI backend for the Cuttlefish project. It provides endpoints for semantic similarity search and retrieval-augmented generation (RAG) using Qdrant and OpenAI.

## Features
- `/similar` — Returns the top 5 most similar entries from Qdrant for a given query.
- `/rag` — Returns an answer generated by OpenAI using the top 5 most similar entries as context (RAG).
- CORS enabled for frontend integration.

## Setup

1. **Install dependencies:**
   ```bash
   pip install -r requirements.txt
   ```

2. **Configure environment variables:**
   Create a `.env` file in this folder (or project root) with:
   ```env
   QDRANT_URL=your_qdrant_url
   QDRANT_API_KEY=your_qdrant_api_key
   QDRANT_COLLECTION=jira_issues
   OPENAI_EMBED_MODEL=text-embedding-3-small
   OPENAI_RAG_MODEL=gpt-3.5-turbo
   ```

3. **Run the server:**
   - From the project root:
     ```bash
     uvicorn api.main:app --reload
     ```
   - Or from the `api` folder:
     ```bash
     uvicorn main:app --reload
     ```

## API Endpoints

### POST `/similar`
- **Request JSON:**
  ```json
  {
    "query": "your search text",
    "openai_api_key": "sk-..."
  }
  ```
- **Response:**
  ```json
  {
    "results": [
      { "id": ..., "score": ..., "payload": { ... } },
      ...
    ]
  }
  ```

### POST `/rag`
- **Request JSON:**
  ```json
  {
    "query": "your search text",
    "openai_api_key": "sk-..."
  }
  ```
- **Response:**
  ```json
  {
    "answer": "...",
    "context": [
      { "id": ..., "score": ..., "payload": { ... } },
      ...
    ]
  }
  ```

## Testing
- Use the provided `test.sh` script or tools like curl/Postman to test endpoints.
- Make sure your backend is running and accessible from your frontend (CORS is enabled).

## Notes
- The OpenAI API key is provided per request for security and flexibility.
- Make sure your Qdrant instance is populated with data before using the endpoints. 